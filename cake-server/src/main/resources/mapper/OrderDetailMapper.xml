<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cake.mapper.OrderDetailMapper">
    <insert id="create">
        insert into order_detail(name, image, num, order_id, product_id, amount)
        VALUES
        <foreach collection="orderDetails"  item="orderDetail" separator=",">
            (#{orderDetail.name}, #{orderDetail.image}, #{orderDetail.num}, #{orderDetail.orderId}, #{orderDetail.productId}, #{orderDetail.amount})
        </foreach>
    </insert>
    <delete id="cancel">
        delete from order_detail where order_id = #{orderId}
    </delete>
    <select id="getorderDetail" resultType="com.cake.entity.OrderDetail">
        select * from order_detail where order_id = #{orderId}
    </select>
    <select id="getCategoryRankings" resultType="com.cake.entity.SaleProduct">
        SELECT  od.product_id as id, od.name,od.amount as price,od.image,sum(od.num) as salesCount
        from order_detail od,orders o ,product p
        where o.pay_status = 1 and o.id = od.order_id and p.category_id = #{categoryId} and p.id = od.product_id
        group by od.product_id, od.name, od.amount, od.image
        ORDER BY salesCount desc limit 3;
    </select>
</mapper>