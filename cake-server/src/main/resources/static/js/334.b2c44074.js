"use strict";(self["webpackChunkcake_shop"]=self["webpackChunkcake_shop"]||[]).push([[334],{4334:function(e,a,t){t.r(a),t.d(a,{default:function(){return E}});var i=t(6768),l=t(4232),s=t(5130);const n={class:"cakes-page"},o={class:"filter-bar"},r={class:"filter-container"},c={class:"filter-group"},d={class:"filter-options"},h=["onClick"],u={class:"filter-group"},k={class:"filter-options"},g=["onClick"],C={key:0,class:"loading-container"},f={key:1,class:"cake-list"};function m(e,a,t,m,p,b){const v=(0,i.g2)("el-button"),F=(0,i.g2)("el-skeleton"),y=(0,i.g2)("cake-card"),D=(0,i.g2)("el-col"),E=(0,i.g2)("el-row"),$=(0,i.g2)("el-empty"),_=(0,i.g2)("cake-form"),w=(0,i.g2)("el-dialog");return(0,i.uX)(),(0,i.CE)("div",n,[(0,i.Lk)("div",o,[(0,i.Lk)("div",r,[(0,i.Lk)("div",c,[a[2]||(a[2]=(0,i.Lk)("span",{class:"filter-label"},"口味：",-1)),(0,i.Lk)("div",d,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.flavors,e=>((0,i.uX)(),(0,i.CE)("span",{key:e.value,class:(0,l.C4)(["filter-option",{active:p.flavorFilter===e.value}]),onClick:a=>b.handleFlavorClick(e.value)},(0,l.v_)(e.label),11,h))),128))])]),(0,i.Lk)("div",u,[a[3]||(a[3]=(0,i.Lk)("span",{class:"filter-label"},"规格：",-1)),(0,i.Lk)("div",k,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(p.numbers,e=>((0,i.uX)(),(0,i.CE)("span",{key:e.value,class:(0,l.C4)(["filter-option",{active:p.numberFilter===e.value}]),onClick:a=>b.handleNumberClick(e.value)},(0,l.v_)(e.label),11,g))),128))])])]),(0,i.bF)(v,{class:"add-button",type:"primary",onClick:b.showAddDialog,icon:"el-icon-plus"},{default:(0,i.k6)(()=>a[4]||(a[4]=[(0,i.eW)(" 新增蛋糕 ",-1)])),_:1,__:[4]},8,["onClick"])]),p.loading?((0,i.uX)(),(0,i.CE)("div",C,[(0,i.bF)(F,{rows:6,animated:""})])):((0,i.uX)(),(0,i.CE)("div",f,[(0,i.bF)(E,{gutter:20},{default:(0,i.k6)(()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(p.cakes,e=>((0,i.uX)(),(0,i.Wv)(D,{key:e.id,xs:24,sm:12,md:8,lg:6},{default:(0,i.k6)(()=>[(0,i.bF)(y,{cake:e,onClick:a=>b.goToDetail(e.id)},{actions:(0,i.k6)(()=>[(0,i.bF)(v,{size:"mini",type:"danger",class:"delete-btn",onClick:(0,s.D$)(a=>b.handleDelete(e.id),["stop"])},{default:(0,i.k6)(()=>a[5]||(a[5]=[(0,i.eW)(" 删除 ",-1)])),_:2,__:[5]},1032,["onClick"]),(0,i.bF)(v,{size:"mini",class:"edit-btn",onClick:(0,s.D$)(a=>b.handleEdit(e),["stop"])},{default:(0,i.k6)(()=>a[6]||(a[6]=[(0,i.eW)(" 编辑 ",-1)])),_:2,__:[6]},1032,["onClick"])]),_:2},1032,["cake","onClick"])]),_:2},1024))),128))]),_:1}),0===p.cakes.length?((0,i.uX)(),(0,i.Wv)($,{key:0,description:"暂无蛋糕商品"})):(0,i.Q3)("",!0)])),(0,i.bF)(w,{title:p.isEdit?"编辑蛋糕":"新增蛋糕",modelValue:p.addDialogVisible,"onUpdate:modelValue":a[1]||(a[1]=e=>p.addDialogVisible=e),width:"50%",onClosed:b.handleDialogClosed,class:"golden-dialog"},{default:(0,i.k6)(()=>[((0,i.uX)(),(0,i.Wv)(_,{ref:"cakeForm",key:p.isEdit?"edit-form":"add-form","is-edit":p.isEdit,"initial-data":p.currentCakeData,onSubmit:b.handleAddCake,onCancel:a[0]||(a[0]=e=>p.addDialogVisible=!1)},null,8,["is-edit","initial-data","onSubmit"]))]),_:1},8,["title","modelValue","onClosed"])])}t(4114),t(8111),t(1701);var p=t(842),b=t(5322),v=t(4323),F={name:"CakeSelection",components:{CakeCard:b.A,CakeForm:v.A},data(){return{isEdit:!0,currentCakeId:null,categoryId:null,loading:!1,cakes:[],tastes:[],flavorFilter:null,numberFilter:null,addDialogVisible:!1,currentCakeData:null,pagination:{pageNum:1,pageSize:8,total:0},numbers:[{value:null,label:"全部"},{value:"1-2人",label:"1-2人"},{value:"3-4人",label:"3-4人"},{value:"5-6人",label:"5-6人"},{value:"7-8人",label:"7-8人"}]}},created(){this.fetchTastes(),this.fetchCakes()},methods:{async fetchTastes(){try{const e=await(0,p.$i)();this.tastes=e.data,this.flavors=[{value:null,label:"全部"},...this.tastes.map(e=>({value:e.id,label:e.flavor}))]}catch(e){console.error("获取口味列表失败",e)}},async fetchCakes(){this.loading=!0;try{await(0,p.$i)();const e={tasteId:this.flavorFilter,number:this.numberFilter,pageNum:this.pagination.pageNum,pageSize:this.pagination.pageSize},a=await(0,p.s9)(e);this.cakes=a.data.records,console.log("甄选蛋糕：",this.cakes),console.log("records长度:",a.data.records?.length),this.pagination.total=a.data.total||0}catch(e){this.$message.error("获取蛋糕列表失败"),console.error(e)}finally{this.loading=!1}},async handleDelete(e){try{await this.$confirm("确定要删除这个蛋糕吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await(0,p.id)(e),this.$message.success("删除成功"),1===this.cakes.length&&this.pagination.pageNum>1&&(this.pagination.pageNum-=1),this.fetchCakes()}catch(a){"cancel"!==a&&(this.$message.error("删除失败"),console.error(a))}},handleFlavorClick(e){this.flavorFilter=this.flavorFilter===e?null:e,this.fetchCakes()},handleNumberClick(e){this.numberFilter=this.numberFilter===e?null:e,this.fetchCakes()},handleSizeChange(e){this.pagination.pageSize=e,this.fetchCakes()},handleCurrentChange(e){this.pagination.pageNum=e,this.fetchCakes()},handleDialogOpened(){this.isEdit&&this.$refs.cakeForm&&this.$refs.cakeForm.setFormData(this.currentCakeData)},goToDetail(e){this.$router.push(`/cake/${e}`)},showAddDialog(){this.isEdit=!1,this.currentCakeId=null,this.currentCakeData=null,this.addDialogVisible=!0},handleDialogClosed(){this.isEdit=!0,this.currentCakeId=null,this.currentCakeData=null},async handleEdit(e){this.loading=!0,console.log("蛋糕id:",e.id);try{this.isEdit=!0,console.log("蛋糕：",e);const a=await(0,p.Z5)(e.id);console.log("获取到的蛋糕详情:",a.data),this.currentCakeData={...a.data},this.currentCakeId=e.id,this.addDialogVisible=!0,this.$nextTick(()=>{this.$refs.cakeForm&&this.$refs.cakeForm.setFormData(this.currentCakeData)})}catch(a){this.$message.error("获取蛋糕详情失败"),console.error(a)}finally{this.loading=!1}},async handleAddCake(e){try{const{specs:a,...t}=e,i=1;i&&(e.categoryId=i),console.log("分类id:",e.categoryId),this.isEdit?(console.log("更新数据：",{...t,id:this.currentCakeId}),await(0,p.Cg)({...t,id:this.currentCakeId}),await(0,p.MN)(this.currentCakeId,a),this.$message.success("蛋糕更新成功")):(await(0,p.mE)(e),this.$message.success("蛋糕添加成功")),this.addDialogVisible=!1,this.fetchCakes()}catch(a){this.$message.error(this.isEdit?"更新失败":"添加失败"),console.error(a)}}}},y=t(1241);const D=(0,y.A)(F,[["render",m],["__scopeId","data-v-f0dac9ba"]]);var E=D}}]);
//# sourceMappingURL=334.b2c44074.js.map